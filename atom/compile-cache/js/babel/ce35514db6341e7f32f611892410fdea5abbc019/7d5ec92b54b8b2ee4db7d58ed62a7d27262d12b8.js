function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/* eslint-env jasmine */

var _libSymbolStore = require('../lib/symbol-store');

var _libSymbolStore2 = _interopRequireDefault(_libSymbolStore);

var _selectorKit = require('selector-kit');

'use babel';

describe('SymbolStore', function () {
  var _ref = [];
  var store = _ref[0];
  var editor = _ref[1];

  beforeEach(function () {
    waitsForPromise(function () {
      return Promise.all([atom.packages.activatePackage('language-coffee-script'), atom.workspace.open('sample.coffee').then(function (e) {
        editor = e;
      })]);
    });

    runs(function () {
      store = new _libSymbolStore2['default'](/\b\w*[a-zA-Z_-]+\w*\b/g);

      editor.setText('');
      editor.getBuffer().onDidChange(function (_ref2) {
        var oldRange = _ref2.oldRange;
        var newRange = _ref2.newRange;
        return store.recomputeSymbolsForEditorInBufferRange(editor, oldRange.start, oldRange.getExtent(), newRange.getExtent());
      });
    });
  });

  describe('::symbolsForConfig(config)', function () {
    it('gets a list of symbols matching the passed in configuration', function () {
      var config = {
        'function': {
          selectors: _selectorKit.Selector.create('.function'),
          typePriority: 1
        }
      };

      editor.setText('\n\nabc = -> cats\n\navar = 1');

      var occurrences = store.symbolsForConfig(config, null, 'ab');
      expect(occurrences.length).toBe(1);
      expect(occurrences[0].symbol.text).toBe('abc');
      expect(occurrences[0].symbol.type).toBe('function');
    });

    it('updates the symbol types as new tokens come in', function () {
      var config = {
        variable: {
          selectors: _selectorKit.Selector.create('.variable'),
          typePriority: 2
        },
        'function': {
          selectors: _selectorKit.Selector.create('.function'),
          typePriority: 3
        },
        'class': {
          selectors: _selectorKit.Selector.create('.class.name'),
          typePriority: 4
        }
      };

      editor.setText('\n\nabc = -> cats\n\navar = 1');
      var occurrences = store.symbolsForConfig(config, null, 'a');

      expect(occurrences.length).toBe(2);
      expect(occurrences[0].symbol.text).toBe('abc');
      expect(occurrences[0].symbol.type).toBe('function');
      expect(occurrences[1].symbol.text).toBe('avar');
      expect(occurrences[1].symbol.type).toBe('variable');

      editor.setCursorBufferPosition([0, 0]);
      editor.insertText('class abc');
      occurrences = store.symbolsForConfig(config, null, 'a');

      expect(occurrences.length).toBe(2);
      expect(occurrences[0].symbol.text).toBe('abc');
      expect(occurrences[0].symbol.type).toBe('class');
      expect(occurrences[1].symbol.text).toBe('avar');
      expect(occurrences[1].symbol.type).toBe('variable');
    });

    it('returns symbols with an empty type', function () {
      var config = {
        '': {
          selectors: _selectorKit.Selector.create('.function'),
          typePriority: 1
        }
      };

      editor.setText('\n\nabc = -> cats\n\navar = 1');
      var occurrences = store.symbolsForConfig(config, null, 'a');

      expect(occurrences.length).toBe(1);
      expect(occurrences[0].symbol.text).toBe('abc');
      expect(occurrences[0].symbol.type).toBe('');
    });

    it('resets the types when a new config is used', function () {
      var config = {
        'function': {
          selectors: _selectorKit.Selector.create('.function'),
          typePriority: 1
        }
      };

      editor.setText('\n\nabc = -> cats\n\navar = 1');
      var occurrences = store.symbolsForConfig(config, null, 'a');

      expect(occurrences.length).toBe(1);
      expect(occurrences[0].symbol.text).toBe('abc');
      expect(occurrences[0].symbol.type).toBe('function');

      config = {
        'newtype': {
          selectors: _selectorKit.Selector.create('.function'),
          typePriority: 1
        }
      };

      editor.setText('\n\nabc = -> cats\n\navar = 1');
      occurrences = store.symbolsForConfig(config, null, 'a');

      expect(occurrences.length).toBe(1);
      expect(occurrences[0].symbol.text).toBe('abc');
      expect(occurrences[0].symbol.type).toBe('newtype');
    });

    it('doesn\'t override built-in suggestions with the symbols found in the buffer', function () {
      var config = {
        'function': {
          selectors: _selectorKit.Selector.create('.function'),
          typePriority: 1
        },
        'builtins': {
          suggestions: [{
            type: 'function',
            rightLabel: 'global function',
            text: 'ValueFromFile',
            description: 'Test description.'
          }]
        }
      };

      editor.moveToBottom();
      editor.insertText('ValueFromFile()');

      var occurrences = store.symbolsForConfig(config, [editor.getBuffer()], 'value');
      expect(occurrences.length).toBe(1);
      expect(occurrences[0].symbol.text).toBe('ValueFromFile');
      expect(occurrences[0].symbol.description).toBe('Test description.');
      expect(occurrences[0].symbol.rightLabel).toBe('global function');
    });
  });

  describe('when there are multiple files with tokens in the store', function () {
    var _ref3 = [];
    var config = _ref3[0];
    var editor1 = _ref3[1];
    var editor2 = _ref3[2];

    beforeEach(function () {
      config = { stuff: { selectors: _selectorKit.Selector.create('.text.plain.null-grammar') } };

      waitsForPromise(function () {
        return Promise.all([atom.workspace.open('one.txt').then(function (editor) {
          editor1 = editor;
        }), atom.workspace.open('two.txt').then(function (editor) {
          editor2 = editor;
        })]);
      });

      runs(function () {
        editor1.moveToBottom();
        editor1.insertText(' humongous hill');

        editor2.moveToBottom();
        editor2.insertText(' hello hola');

        var start = { row: 0, column: 0 };
        var oldExtent = { row: 0, column: 0 };
        store.recomputeSymbolsForEditorInBufferRange(editor1, start, oldExtent, editor1.getBuffer().getRange().getExtent());
        store.recomputeSymbolsForEditorInBufferRange(editor2, start, oldExtent, editor2.getBuffer().getRange().getExtent());
      });
    });

    describe('::symbolsForConfig(config)', function () {
      return it('returs symbols based on path', function () {
        var occurrences = store.symbolsForConfig(config, [editor1.getBuffer()], 'h');
        expect(occurrences).toHaveLength(2);
        expect(occurrences[0].symbol.text).toBe('humongous');
        expect(occurrences[1].symbol.text).toBe('hill');

        occurrences = store.symbolsForConfig(config, [editor2.getBuffer()], 'h');
        expect(occurrences).toHaveLength(2);
        expect(occurrences[0].symbol.text).toBe('hello');
        expect(occurrences[1].symbol.text).toBe('hola');
      });
    });

    describe('::clear()', function () {
      return describe('when a buffer is specified', function () {
        return it('removes only the path specified', function () {
          var occurrences = store.symbolsForConfig(config, null, 'h');
          expect(occurrences).toHaveLength(4);
          expect(occurrences[0].symbol.text).toBe('humongous');
          expect(occurrences[1].symbol.text).toBe('hill');
          expect(occurrences[2].symbol.text).toBe('hello');
          expect(occurrences[3].symbol.text).toBe('hola');

          store.clear(editor1.getBuffer());

          occurrences = store.symbolsForConfig(config, null, 'h');
          expect(occurrences).toHaveLength(2);
          expect(occurrences[0].symbol.text).toBe('hello');
          expect(occurrences[1].symbol.text).toBe('hola');
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2p1YW5qby8uYXRvbS9wYWNrYWdlcy9hdXRvY29tcGxldGUtcGx1cy9zcGVjL3N5bWJvbC1zdG9yZS1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OEJBR3dCLHFCQUFxQjs7OzsyQkFDcEIsY0FBYzs7QUFKdkMsV0FBVyxDQUFBOztBQU1YLFFBQVEsQ0FBQyxhQUFhLEVBQUUsWUFBTTthQUNOLEVBQUU7TUFBbkIsS0FBSztNQUFFLE1BQU07O0FBQ2xCLFlBQVUsQ0FBQyxZQUFNO0FBQ2YsbUJBQWUsQ0FBQzthQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FDVixJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyx3QkFBd0IsQ0FBQyxFQUN2RCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUs7QUFBRSxjQUFNLEdBQUcsQ0FBQyxDQUFBO09BQUUsQ0FBQyxDQUNqRSxDQUFDO0tBQUEsQ0FBQyxDQUFBOztBQUVMLFFBQUksQ0FBQyxZQUFNO0FBQ1QsV0FBSyxHQUFHLGdDQUFnQix3QkFBd0IsQ0FBQyxDQUFBOztBQUVqRCxZQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFBO0FBQ2xCLFlBQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLENBQUMsVUFBQyxLQUFvQjtZQUFuQixRQUFRLEdBQVQsS0FBb0IsQ0FBbkIsUUFBUTtZQUFFLFFBQVEsR0FBbkIsS0FBb0IsQ0FBVCxRQUFRO2VBQU0sS0FBSyxDQUFDLHNDQUFzQyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7T0FBQSxDQUFDLENBQUE7S0FDM0ssQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBOztBQUVGLFVBQVEsQ0FBQyw0QkFBNEIsRUFBRSxZQUFNO0FBQzNDLE1BQUUsQ0FBQyw2REFBNkQsRUFBRSxZQUFNO0FBQ3RFLFVBQUksTUFBTSxHQUFHO0FBQ1gsb0JBQVU7QUFDUixtQkFBUyxFQUFFLHNCQUFTLE1BQU0sQ0FBQyxXQUFXLENBQUM7QUFDdkMsc0JBQVksRUFBRSxDQUFDO1NBQ2hCO09BQ0YsQ0FBQTs7QUFFRCxZQUFNLENBQUMsT0FBTyxDQUFDLCtCQUErQixDQUFDLENBQUE7O0FBRS9DLFVBQUksV0FBVyxHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQzVELFlBQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2xDLFlBQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUM5QyxZQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7S0FDcEQsQ0FBQyxDQUFBOztBQUVGLE1BQUUsQ0FBQyxnREFBZ0QsRUFBRSxZQUFNO0FBQ3pELFVBQUksTUFBTSxHQUFHO0FBQ1gsZ0JBQVEsRUFBRTtBQUNSLG1CQUFTLEVBQUUsc0JBQVMsTUFBTSxDQUFDLFdBQVcsQ0FBQztBQUN2QyxzQkFBWSxFQUFFLENBQUM7U0FDaEI7QUFDRCxvQkFBVTtBQUNSLG1CQUFTLEVBQUUsc0JBQVMsTUFBTSxDQUFDLFdBQVcsQ0FBQztBQUN2QyxzQkFBWSxFQUFFLENBQUM7U0FDaEI7QUFDRCxpQkFBTztBQUNMLG1CQUFTLEVBQUUsc0JBQVMsTUFBTSxDQUFDLGFBQWEsQ0FBQztBQUN6QyxzQkFBWSxFQUFFLENBQUM7U0FDaEI7T0FDRixDQUFBOztBQUVELFlBQU0sQ0FBQyxPQUFPLENBQUMsK0JBQStCLENBQUMsQ0FBQTtBQUMvQyxVQUFJLFdBQVcsR0FBRyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQTs7QUFFM0QsWUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDbEMsWUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQzlDLFlBQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtBQUNuRCxZQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7QUFDL0MsWUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBOztBQUVuRCxZQUFNLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUN0QyxZQUFNLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0FBQzlCLGlCQUFXLEdBQUcsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUE7O0FBRXZELFlBQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2xDLFlBQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUM5QyxZQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxD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QUEsQ0FDSDtLQUFBLENBQ0YsQ0FBQTtHQUNGLENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvaG9tZS9qdWFuam8vLmF0b20vcGFja2FnZXMvYXV0b2NvbXBsZXRlLXBsdXMvc3BlYy9zeW1ib2wtc3RvcmUtc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG4vKiBlc2xpbnQtZW52IGphc21pbmUgKi9cblxuaW1wb3J0IFN5bWJvbFN0b3JlIGZyb20gJy4uL2xpYi9zeW1ib2wtc3RvcmUnXG5pbXBvcnQgeyBTZWxlY3RvciB9IGZyb20gJ3NlbGVjdG9yLWtpdCdcblxuZGVzY3JpYmUoJ1N5bWJvbFN0b3JlJywgKCkgPT4ge1xuICBsZXQgW3N0b3JlLCBlZGl0b3JdID0gW11cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgd2FpdHNGb3JQcm9taXNlKCgpID0+XG4gICAgICBQcm9taXNlLmFsbChbXG4gICAgICAgIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdsYW5ndWFnZS1jb2ZmZWUtc2NyaXB0JyksXG4gICAgICAgIGF0b20ud29ya3NwYWNlLm9wZW4oJ3NhbXBsZS5jb2ZmZWUnKS50aGVuKChlKSA9PiB7IGVkaXRvciA9IGUgfSlcbiAgICAgIF0pKVxuXG4gICAgcnVucygoKSA9PiB7XG4gICAgICBzdG9yZSA9IG5ldyBTeW1ib2xTdG9yZSgvXFxiXFx3KlthLXpBLVpfLV0rXFx3KlxcYi9nKVxuXG4gICAgICBlZGl0b3Iuc2V0VGV4dCgnJylcbiAgICAgIGVkaXRvci5nZXRCdWZmZXIoKS5vbkRpZENoYW5nZSgoe29sZFJhbmdlLCBuZXdSYW5nZX0pID0+IHN0b3JlLnJlY29tcHV0ZVN5bWJvbHNGb3JFZGl0b3JJbkJ1ZmZlclJhbmdlKGVkaXRvciwgb2xkUmFuZ2Uuc3RhcnQsIG9sZFJhbmdlLmdldEV4dGVudCgpLCBuZXdSYW5nZS5nZXRFeHRlbnQoKSkpXG4gICAgfSlcbiAgfSlcblxuICBkZXNjcmliZSgnOjpzeW1ib2xzRm9yQ29uZmlnKGNvbmZpZyknLCAoKSA9PiB7XG4gICAgaXQoJ2dldHMgYSBsaXN0IG9mIHN5bWJvbHMgbWF0Y2hpbmcgdGhlIHBhc3NlZCBpbiBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgZnVuY3Rpb246IHtcbiAgICAgICAgICBzZWxlY3RvcnM6IFNlbGVjdG9yLmNyZWF0ZSgnLmZ1bmN0aW9uJyksXG4gICAgICAgICAgdHlwZVByaW9yaXR5OiAxXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZWRpdG9yLnNldFRleHQoJ1xcblxcbmFiYyA9IC0+IGNhdHNcXG5cXG5hdmFyID0gMScpXG5cbiAgICAgIGxldCBvY2N1cnJlbmNlcyA9IHN0b3JlLnN5bWJvbHNGb3JDb25maWcoY29uZmlnLCBudWxsLCAnYWInKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzLmxlbmd0aCkudG9CZSgxKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50ZXh0KS50b0JlKCdhYmMnKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50eXBlKS50b0JlKCdmdW5jdGlvbicpXG4gICAgfSlcblxuICAgIGl0KCd1cGRhdGVzIHRoZSBzeW1ib2wgdHlwZXMgYXMgbmV3IHRva2VucyBjb21lIGluJywgKCkgPT4ge1xuICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgdmFyaWFibGU6IHtcbiAgICAgICAgICBzZWxlY3RvcnM6IFNlbGVjdG9yLmNyZWF0ZSgnLnZhcmlhYmxlJyksXG4gICAgICAgICAgdHlwZVByaW9yaXR5OiAyXG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uOiB7XG4gICAgICAgICAgc2VsZWN0b3JzOiBTZWxlY3Rvci5jcmVhdGUoJy5mdW5jdGlvbicpLFxuICAgICAgICAgIHR5cGVQcmlvcml0eTogM1xuICAgICAgICB9LFxuICAgICAgICBjbGFzczoge1xuICAgICAgICAgIHNlbGVjdG9yczogU2VsZWN0b3IuY3JlYXRlKCcuY2xhc3MubmFtZScpLFxuICAgICAgICAgIHR5cGVQcmlvcml0eTogNFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGVkaXRvci5zZXRUZXh0KCdcXG5cXG5hYmMgPSAtPiBjYXRzXFxuXFxuYXZhciA9IDEnKVxuICAgICAgbGV0IG9jY3VycmVuY2VzID0gc3RvcmUuc3ltYm9sc0ZvckNvbmZpZyhjb25maWcsIG51bGwsICdhJylcblxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzLmxlbmd0aCkudG9CZSgyKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50ZXh0KS50b0JlKCdhYmMnKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50eXBlKS50b0JlKCdmdW5jdGlvbicpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMV0uc3ltYm9sLnRleHQpLnRvQmUoJ2F2YXInKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzFdLnN5bWJvbC50eXBlKS50b0JlKCd2YXJpYWJsZScpXG5cbiAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbMCwgMF0pXG4gICAgICBlZGl0b3IuaW5zZXJ0VGV4dCgnY2xhc3MgYWJjJylcbiAgICAgIG9jY3VycmVuY2VzID0gc3RvcmUuc3ltYm9sc0ZvckNvbmZpZyhjb25maWcsIG51bGwsICdhJylcblxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzLmxlbmd0aCkudG9CZSgyKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50ZXh0KS50b0JlKCdhYmMnKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50eXBlKS50b0JlKCdjbGFzcycpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMV0uc3ltYm9sLnRleHQpLnRvQmUoJ2F2YXInKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzFdLnN5bWJvbC50eXBlKS50b0JlKCd2YXJpYWJsZScpXG4gICAgfSlcblxuICAgIGl0KCdyZXR1cm5zIHN5bWJvbHMgd2l0aCBhbiBlbXB0eSB0eXBlJywgKCkgPT4ge1xuICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgJyc6IHtcbiAgICAgICAgICBzZWxlY3RvcnM6IFNlbGVjdG9yLmNyZWF0ZSgnLmZ1bmN0aW9uJyksXG4gICAgICAgICAgdHlwZVByaW9yaXR5OiAxXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZWRpdG9yLnNldFRleHQoJ1xcblxcbmFiYyA9IC0+IGNhdHNcXG5cXG5hdmFyID0gMScpXG4gICAgICBsZXQgb2NjdXJyZW5jZXMgPSBzdG9yZS5zeW1ib2xzRm9yQ29uZmlnKGNvbmZpZywgbnVsbCwgJ2EnKVxuXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXMubGVuZ3RoKS50b0JlKDEpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMF0uc3ltYm9sLnRleHQpLnRvQmUoJ2FiYycpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMF0uc3ltYm9sLnR5cGUpLnRvQmUoJycpXG4gICAgfSlcblxuICAgIGl0KCdyZXNldHMgdGhlIHR5cGVzIHdoZW4gYSBuZXcgY29uZmlnIGlzIHVzZWQnLCAoKSA9PiB7XG4gICAgICBsZXQgY29uZmlnID0ge1xuICAgICAgICAnZnVuY3Rpb24nOiB7XG4gICAgICAgICAgc2VsZWN0b3JzOiBTZWxlY3Rvci5jcmVhdGUoJy5mdW5jdGlvbicpLFxuICAgICAgICAgIHR5cGVQcmlvcml0eTogMVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGVkaXRvci5zZXRUZXh0KCdcXG5cXG5hYmMgPSAtPiBjYXRzXFxuXFxuYXZhciA9IDEnKVxuICAgICAgbGV0IG9jY3VycmVuY2VzID0gc3RvcmUuc3ltYm9sc0ZvckNvbmZpZyhjb25maWcsIG51bGwsICdhJylcblxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzLmxlbmd0aCkudG9CZSgxKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50ZXh0KS50b0JlKCdhYmMnKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50eXBlKS50b0JlKCdmdW5jdGlvbicpXG5cbiAgICAgIGNvbmZpZyA9IHtcbiAgICAgICAgJ25ld3R5cGUnOiB7XG4gICAgICAgICAgc2VsZWN0b3JzOiBTZWxlY3Rvci5jcmVhdGUoJy5mdW5jdGlvbicpLFxuICAgICAgICAgIHR5cGVQcmlvcml0eTogMVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGVkaXRvci5zZXRUZXh0KCdcXG5cXG5hYmMgPSAtPiBjYXRzXFxuXFxuYXZhciA9IDEnKVxuICAgICAgb2NjdXJyZW5jZXMgPSBzdG9yZS5zeW1ib2xzRm9yQ29uZmlnKGNvbmZpZywgbnVsbCwgJ2EnKVxuXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXMubGVuZ3RoKS50b0JlKDEpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMF0uc3ltYm9sLnRleHQpLnRvQmUoJ2FiYycpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMF0uc3ltYm9sLnR5cGUpLnRvQmUoJ25ld3R5cGUnKVxuICAgIH0pXG5cbiAgICBpdCgnZG9lc25cXCd0IG92ZXJyaWRlIGJ1aWx0LWluIHN1Z2dlc3Rpb25zIHdpdGggdGhlIHN5bWJvbHMgZm91bmQgaW4gdGhlIGJ1ZmZlcicsICgpID0+IHtcbiAgICAgIGxldCBjb25maWcgPSB7XG4gICAgICAgICdmdW5jdGlvbic6IHtcbiAgICAgICAgICBzZWxlY3RvcnM6IFNlbGVjdG9yLmNyZWF0ZSgnLmZ1bmN0aW9uJyksXG4gICAgICAgICAgdHlwZVByaW9yaXR5OiAxXG4gICAgICAgIH0sXG4gICAgICAgICdidWlsdGlucyc6IHtcbiAgICAgICAgICBzdWdnZXN0aW9uczogW3tcbiAgICAgICAgICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgICAgICByaWdodExhYmVsOiAnZ2xvYmFsIGZ1bmN0aW9uJyxcbiAgICAgICAgICAgIHRleHQ6ICdWYWx1ZUZyb21GaWxlJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBkZXNjcmlwdGlvbi4nXG4gICAgICAgICAgfV1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBlZGl0b3IubW92ZVRvQm90dG9tKClcbiAgICAgIGVkaXRvci5pbnNlcnRUZXh0KCdWYWx1ZUZyb21GaWxlKCknKVxuXG4gICAgICBsZXQgb2NjdXJyZW5jZXMgPSBzdG9yZS5zeW1ib2xzRm9yQ29uZmlnKGNvbmZpZywgW2VkaXRvci5nZXRCdWZmZXIoKV0sICd2YWx1ZScpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXMubGVuZ3RoKS50b0JlKDEpXG4gICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMF0uc3ltYm9sLnRleHQpLnRvQmUoJ1ZhbHVlRnJvbUZpbGUnKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC5kZXNjcmlwdGlvbikudG9CZSgnVGVzdCBkZXNjcmlwdGlvbi4nKVxuICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC5yaWdodExhYmVsKS50b0JlKCdnbG9iYWwgZnVuY3Rpb24nKVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ3doZW4gdGhlcmUgYXJlIG11bHRpcGxlIGZpbGVzIHdpdGggdG9rZW5zIGluIHRoZSBzdG9yZScsICgpID0+IHtcbiAgICBsZXQgW2NvbmZpZywgZWRpdG9yMSwgZWRpdG9yMl0gPSBbXVxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uZmlnID0ge3N0dWZmOiB7IHNlbGVjdG9yczogU2VsZWN0b3IuY3JlYXRlKCcudGV4dC5wbGFpbi5udWxsLWdyYW1tYXInKSB9fVxuXG4gICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT5cbiAgICAgICAgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgIGF0b20ud29ya3NwYWNlLm9wZW4oJ29uZS50eHQnKS50aGVuKChlZGl0b3IpID0+IHsgZWRpdG9yMSA9IGVkaXRvciB9KSxcbiAgICAgICAgICBhdG9tLndvcmtzcGFjZS5vcGVuKCd0d28udHh0JykudGhlbigoZWRpdG9yKSA9PiB7IGVkaXRvcjIgPSBlZGl0b3IgfSlcbiAgICAgICAgXSkpXG5cbiAgICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgICBlZGl0b3IxLm1vdmVUb0JvdHRvbSgpXG4gICAgICAgIGVkaXRvcjEuaW5zZXJ0VGV4dCgnIGh1bW9uZ291cyBoaWxsJylcblxuICAgICAgICBlZGl0b3IyLm1vdmVUb0JvdHRvbSgpXG4gICAgICAgIGVkaXRvcjIuaW5zZXJ0VGV4dCgnIGhlbGxvIGhvbGEnKVxuXG4gICAgICAgIGxldCBzdGFydCA9IHtyb3c6IDAsIGNvbHVtbjogMH1cbiAgICAgICAgbGV0IG9sZEV4dGVudCA9IHtyb3c6IDAsIGNvbHVtbjogMH1cbiAgICAgICAgc3RvcmUucmVjb21wdXRlU3ltYm9sc0ZvckVkaXRvckluQnVmZmVyUmFuZ2UoZWRpdG9yMSwgc3RhcnQsIG9sZEV4dGVudCwgZWRpdG9yMS5nZXRCdWZmZXIoKS5nZXRSYW5nZSgpLmdldEV4dGVudCgpKVxuICAgICAgICBzdG9yZS5yZWNvbXB1dGVTeW1ib2xzRm9yRWRpdG9ySW5CdWZmZXJSYW5nZShlZGl0b3IyLCBzdGFydCwgb2xkRXh0ZW50LCBlZGl0b3IyLmdldEJ1ZmZlcigpLmdldFJhbmdlKCkuZ2V0RXh0ZW50KCkpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBkZXNjcmliZSgnOjpzeW1ib2xzRm9yQ29uZmlnKGNvbmZpZyknLCAoKSA9PlxuICAgICAgaXQoJ3JldHVycyBzeW1ib2xzIGJhc2VkIG9uIHBhdGgnLCAoKSA9PiB7XG4gICAgICAgIGxldCBvY2N1cnJlbmNlcyA9IHN0b3JlLnN5bWJvbHNGb3JDb25maWcoY29uZmlnLCBbZWRpdG9yMS5nZXRCdWZmZXIoKV0sICdoJylcbiAgICAgICAgZXhwZWN0KG9jY3VycmVuY2VzKS50b0hhdmVMZW5ndGgoMilcbiAgICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50ZXh0KS50b0JlKCdodW1vbmdvdXMnKVxuICAgICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMV0uc3ltYm9sLnRleHQpLnRvQmUoJ2hpbGwnKVxuXG4gICAgICAgIG9jY3VycmVuY2VzID0gc3RvcmUuc3ltYm9sc0ZvckNvbmZpZyhjb25maWcsIFtlZGl0b3IyLmdldEJ1ZmZlcigpXSwgJ2gnKVxuICAgICAgICBleHBlY3Qob2NjdXJyZW5jZXMpLnRvSGF2ZUxlbmd0aCgyKVxuICAgICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMF0uc3ltYm9sLnRleHQpLnRvQmUoJ2hlbGxvJylcbiAgICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzFdLnN5bWJvbC50ZXh0KS50b0JlKCdob2xhJylcbiAgICAgIH0pXG4gICAgKVxuXG4gICAgZGVzY3JpYmUoJzo6Y2xlYXIoKScsICgpID0+XG4gICAgICBkZXNjcmliZSgnd2hlbiBhIGJ1ZmZlciBpcyBzcGVjaWZpZWQnLCAoKSA9PlxuICAgICAgICBpdCgncmVtb3ZlcyBvbmx5IHRoZSBwYXRoIHNwZWNpZmllZCcsICgpID0+IHtcbiAgICAgICAgICBsZXQgb2NjdXJyZW5jZXMgPSBzdG9yZS5zeW1ib2xzRm9yQ29uZmlnKGNvbmZpZywgbnVsbCwgJ2gnKVxuICAgICAgICAgIGV4cGVjdChvY2N1cnJlbmNlcykudG9IYXZlTGVuZ3RoKDQpXG4gICAgICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzBdLnN5bWJvbC50ZXh0KS50b0JlKCdodW1vbmdvdXMnKVxuICAgICAgICAgIGV4cGVjdChvY2N1cnJlbmNlc1sxXS5zeW1ib2wudGV4dCkudG9CZSgnaGlsbCcpXG4gICAgICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzJdLnN5bWJvbC50ZXh0KS50b0JlKCdoZWxsbycpXG4gICAgICAgICAgZXhwZWN0KG9jY3VycmVuY2VzWzNdLnN5bWJvbC50ZXh0KS50b0JlKCdob2xhJylcblxuICAgICAgICAgIHN0b3JlLmNsZWFyKGVkaXRvcjEuZ2V0QnVmZmVyKCkpXG5cbiAgICAgICAgICBvY2N1cnJlbmNlcyA9IHN0b3JlLnN5bWJvbHNGb3JDb25maWcoY29uZmlnLCBudWxsLCAnaCcpXG4gICAgICAgICAgZXhwZWN0KG9jY3VycmVuY2VzKS50b0hhdmVMZW5ndGgoMilcbiAgICAgICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMF0uc3ltYm9sLnRleHQpLnRvQmUoJ2hlbGxvJylcbiAgICAgICAgICBleHBlY3Qob2NjdXJyZW5jZXNbMV0uc3ltYm9sLnRleHQpLnRvQmUoJ2hvbGEnKVxuICAgICAgICB9KVxuICAgICAgKVxuICAgIClcbiAgfSlcbn0pXG4iXX0=
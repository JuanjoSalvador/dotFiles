(function() {
  module.exports = function(colorPicker) {
    return {
      Emitter: (require('../modules/Emitter'))(),
      element: null,
      control: null,
      canvas: null,
      emitSelectionChanged: function() {
        return this.Emitter.emit('selectionChanged', this.control.selection);
      },
      onSelectionChanged: function(callback) {
        return this.Emitter.on('selectionChanged', callback);
      },
      emitColorChanged: function() {
        return this.Emitter.emit('colorChanged', this.control.selection.color);
      },
      onColorChanged: function(callback) {
        return this.Emitter.on('colorChanged', callback);
      },
      activate: function() {
        var Body;
        Body = colorPicker.getExtension('Body');
        this.element = {
          el: (function() {
            var _classPrefix, _el;
            _classPrefix = Body.element.el.className;
            _el = document.createElement('div');
            _el.classList.add(_classPrefix + "-alpha");
            return _el;
          })(),
          width: 0,
          height: 0,
          getWidth: function() {
            return this.width || this.el.offsetWidth;
          },
          getHeight: function() {
            return this.height || this.el.offsetHeight;
          },
          rect: null,
          getRect: function() {
            return this.rect || this.updateRect();
          },
          updateRect: function() {
            return this.rect = this.el.getClientRects()[0];
          },
          add: function(element) {
            this.el.appendChild(element);
            return this;
          }
        };
        Body.element.add(this.element.el, 1);
        colorPicker.onOpen((function(_this) {
          return function() {
            return _this.element.updateRect();
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Alpha, Saturation, _elementHeight, _elementWidth;
            Alpha = _this;
            Saturation = colorPicker.getExtension('Saturation');
            _elementWidth = _this.element.getWidth();
            _elementHeight = _this.element.getHeight();
            _this.canvas = {
              el: (function() {
                var _el;
                _el = document.createElement('canvas');
                _el.width = _elementWidth;
                _el.height = _elementHeight;
                _el.classList.add(Alpha.element.el.className + "-canvas");
                return _el;
              })(),
              context: null,
              getContext: function() {
                return this.context || (this.context = this.el.getContext('2d'));
              },
              previousRender: null,
              render: function(smartColor) {
                var _context, _gradient, _rgb;
                _rgb = ((function() {
                  if (!smartColor) {
                    return colorPicker.SmartColor.HEX('#f00');
                  } else {
                    return smartColor;
                  }
                })()).toRGBArray().join(',');
                if (this.previousRender && this.previousRender === _rgb) {
                  return;
                }
                _context = this.getContext();
                _context.clearRect(0, 0, _elementWidth, _elementHeight);
                _gradient = _context.createLinearGradient(0, 0, 1, _elementHeight);
                _gradient.addColorStop(.01, "rgba(" + _rgb + ",1)");
                _gradient.addColorStop(.99, "rgba(" + _rgb + ",0)");
                _context.fillStyle = _gradient;
                _context.fillRect(0, 0, _elementWidth, _elementHeight);
                return this.previousRender = _rgb;
              }
            };
            Saturation.onColorChanged(function(smartColor) {
              return _this.canvas.render(smartColor);
            });
            _this.canvas.render();
            return _this.element.add(_this.canvas.el);
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var Alpha, Saturation, hasChild;
            hasChild = function(element, child) {
              var _parent;
              if (child && (_parent = child.parentNode)) {
                if (child === element) {
                  return true;
                } else {
                  return hasChild(element, _parent);
                }
              }
              return false;
            };
            Alpha = _this;
            Saturation = colorPicker.getExtension('Saturation');
            _this.control = {
              el: (function() {
                var _el;
                _el = document.createElement('div');
                _el.classList.add(Alpha.element.el.className + "-control");
                return _el;
              })(),
              isGrabbing: false,
              previousControlPosition: null,
              updateControlPosition: function(y) {
                var _joined;
                _joined = "," + y;
                if (this.previousControlPosition && this.previousControlPosition === _joined) {
                  return;
                }
                requestAnimationFrame((function(_this) {
                  return function() {
                    return _this.el.style.top = y + "px";
                  };
                })(this));
                return this.previousControlPosition = _joined;
              },
              selection: {
                y: 0,
                color: null,
                alpha: null
              },
              setSelection: function(e, alpha, offset) {
                var _RGBAArray, _alpha, _height, _position, _rect, _smartColor, _width, _y;
                if (alpha == null) {
                  alpha = null;
                }
                if (offset == null) {
                  offset = null;
                }
                _rect = Alpha.element.getRect();
                _width = Alpha.element.getWidth();
                _height = Alpha.element.getHeight();
                if (e) {
                  _y = e.pageY - _rect.top;
                } else if (typeof alpha === 'number') {
                  _y = _height - (alpha * _height);
                } else if (typeof offset === 'number') {
                  _y = this.selection.y + offset;
                } else {
                  _y = this.selection.y;
                }
                _y = this.selection.y = Math.max(0, Math.min(_height, _y));
                _alpha = 1 - (_y / _height);
                this.selection.alpha = (Math.round(_alpha * 100)) / 100;
                if (_smartColor = this.selection.color) {
                  _RGBAArray = _smartColor.toRGBAArray();
                  _RGBAArray[3] = this.selection.alpha;
                  this.selection.color = colorPicker.SmartColor.RGBAArray(_RGBAArray);
                  Alpha.emitColorChanged();
                } else {
                  this.selection.color = colorPicker.SmartColor.RGBAArray([255, 0, 0, this.selection.alpha]);
                }
                _position = {
                  y: Math.max(3, Math.min(_height - 6, _y))
                };
                this.updateControlPosition(_position.y);
                return Alpha.emitSelectionChanged();
              },
              refreshSelection: function() {
                return this.setSelection();
              }
            };
            _this.control.refreshSelection();
            colorPicker.onInputColor(function(smartColor) {
              return _this.control.setSelection(null, smartColor.getAlpha());
            });
            colorPicker.onOpen(function() {
              return _this.control.isGrabbing = false;
            });
            colorPicker.onClose(function() {
              return _this.control.isGrabbing = false;
            });
            Saturation.onColorChanged(function(smartColor) {
              _this.control.selection.color = smartColor;
              return _this.control.refreshSelection();
            });
            colorPicker.onMouseDown(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Alpha.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              _this.control.isGrabbing = true;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseMove(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseUp(function(e) {
              if (!_this.control.isGrabbing) {
                return;
              }
              _this.control.isGrabbing = false;
              return _this.control.setSelection(e);
            });
            colorPicker.onMouseWheel(function(e, isOnPicker) {
              if (!(isOnPicker && hasChild(Alpha.element.el, e.target))) {
                return;
              }
              e.preventDefault();
              return _this.control.setSelection(null, null, e.wheelDeltaY * .33);
            });
            return _this.element.add(_this.control.el);
          };
        })(this));
        return this;
      }
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvanVhbmpvLy5hdG9tL3BhY2thZ2VzL2NvbG9yLXBpY2tlci9saWIvZXh0ZW5zaW9ucy9BbHBoYS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBS0k7RUFBQSxNQUFNLENBQUMsT0FBUCxHQUFpQixTQUFDLFdBQUQ7V0FDYjtNQUFBLE9BQUEsRUFBUyxDQUFDLE9BQUEsQ0FBUSxvQkFBUixDQUFELENBQUEsQ0FBQSxDQUFUO01BRUEsT0FBQSxFQUFTLElBRlQ7TUFHQSxPQUFBLEVBQVMsSUFIVDtNQUlBLE1BQUEsRUFBUSxJQUpSO01BVUEsb0JBQUEsRUFBc0IsU0FBQTtlQUNsQixJQUFDLENBQUEsT0FBTyxDQUFDLElBQVQsQ0FBYyxrQkFBZCxFQUFrQyxJQUFDLENBQUEsT0FBTyxDQUFDLFNBQTNDO01BRGtCLENBVnRCO01BWUEsa0JBQUEsRUFBb0IsU0FBQyxRQUFEO2VBQ2hCLElBQUMsQ0FBQSxPQUFPLENBQUMsRUFBVCxDQUFZLGtCQUFaLEVBQWdDLFFBQWhDO01BRGdCLENBWnBCO01BZ0JBLGdCQUFBLEVBQWtCLFNBQUE7ZUFDZCxJQUFDLENBQUEsT0FBTyxDQUFDLElBQVQsQ0FBYyxjQUFkLEVBQThCLElBQUMsQ0FBQSxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQWpEO01BRGMsQ0FoQmxCO01Ba0JBLGNBQUEsRUFBZ0IsU0FBQyxRQUFEO2VBQ1osSUFBQyxDQUFBLE9BQU8sQ0FBQyxFQUFULENBQVksY0FBWixFQUE0QixRQUE1QjtNQURZLENBbEJoQjtNQXdCQSxRQUFBLEVBQVUsU0FBQTtBQUNOLFlBQUE7UUFBQSxJQUFBLEdBQU8sV0FBVyxDQUFDLFlBQVosQ0FBeUIsTUFBekI7UUFJUCxJQUFDLENBQUEsT0FBRCxHQUNJO1VBQUEsRUFBQSxFQUFPLENBQUEsU0FBQTtBQUNILGdCQUFBO1lBQUEsWUFBQSxHQUFlLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQy9C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QUMsQ0FBQSxPQUFPLENBQUMsRUFBdEI7VUExR087UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQVg7QUEyR0EsZUFBTztNQXBNRCxDQXhCVjs7RUFEYTtBQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyAgQ29sb3IgUGlja2VyL2V4dGVuc2lvbnM6IEFscGhhXG4jICBDb2xvciBBbHBoYSBjb250cm9sbGVyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gKGNvbG9yUGlja2VyKSAtPlxuICAgICAgICBFbWl0dGVyOiAocmVxdWlyZSAnLi4vbW9kdWxlcy9FbWl0dGVyJykoKVxuXG4gICAgICAgIGVsZW1lbnQ6IG51bGxcbiAgICAgICAgY29udHJvbDogbnVsbFxuICAgICAgICBjYW52YXM6IG51bGxcblxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICMgIFNldCB1cCBldmVudHMgYW5kIGhhbmRsaW5nXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICMgU2VsZWN0aW9uIENoYW5nZWQgZXZlbnRcbiAgICAgICAgZW1pdFNlbGVjdGlvbkNoYW5nZWQ6IC0+XG4gICAgICAgICAgICBARW1pdHRlci5lbWl0ICdzZWxlY3Rpb25DaGFuZ2VkJywgQGNvbnRyb2wuc2VsZWN0aW9uXG4gICAgICAgIG9uU2VsZWN0aW9uQ2hhbmdlZDogKGNhbGxiYWNrKSAtPlxuICAgICAgICAgICAgQEVtaXR0ZXIub24gJ3NlbGVjdGlvbkNoYW5nZWQnLCBjYWxsYmFja1xuXG4gICAgICAgICMgQ29sb3IgQ2hhbmdlZCBldmVudFxuICAgICAgICBlbWl0Q29sb3JDaGFuZ2VkOiAtPlxuICAgICAgICAgICAgQEVtaXR0ZXIuZW1pdCAnY29sb3JDaGFuZ2VkJywgQGNvbnRyb2wuc2VsZWN0aW9uLmNvbG9yXG4gICAgICAgIG9uQ29sb3JDaGFuZ2VkOiAoY2FsbGJhY2spIC0+XG4gICAgICAgICAgICBARW1pdHRlci5vbiAnY29sb3JDaGFuZ2VkJywgY2FsbGJhY2tcblxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICMgIENyZWF0ZSBhbmQgYWN0aXZhdGUgQWxwaGEgY29udHJvbGxlclxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICBhY3RpdmF0ZTogLT5cbiAgICAgICAgICAgIEJvZHkgPSBjb2xvclBpY2tlci5nZXRFeHRlbnNpb24gJ0JvZHknXG5cbiAgICAgICAgIyAgQ3JlYXRlIGVsZW1lbnRcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIEBlbGVtZW50ID1cbiAgICAgICAgICAgICAgICBlbDogZG8gLT5cbiAgICAgICAgICAgICAgICAgICAgX2NsYXNzUHJlZml4ID0gQm9keS5lbGVtZW50LmVsLmNsYXNzTmFtZVxuICAgICAgICAgICAgICAgICAgICBfZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICdkaXYnXG4gICAgICAgICAgICAgICAgICAgIF9lbC5jbGFzc0xpc3QuYWRkIFwiI3sgX2NsYXNzUHJlZml4IH0tYWxwaGFcIlxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfZWxcbiAgICAgICAgICAgICAgICAjIFV0aWxpdHkgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgd2lkdGg6IDBcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDBcbiAgICAgICAgICAgICAgICBnZXRXaWR0aDogLT4gcmV0dXJuIEB3aWR0aCBvciBAZWwub2Zmc2V0V2lkdGhcbiAgICAgICAgICAgICAgICBnZXRIZWlnaHQ6IC0+IHJldHVybiBAaGVpZ2h0IG9yIEBlbC5vZmZzZXRIZWlnaHRcblxuICAgICAgICAgICAgICAgIHJlY3Q6IG51bGxcbiAgICAgICAgICAgICAgICBnZXRSZWN0OiAtPiByZXR1cm4gQHJlY3Qgb3IgQHVwZGF0ZVJlY3QoKVxuICAgICAgICAgICAgICAgIHVwZGF0ZVJlY3Q6IC0+IEByZWN0ID0gQGVsLmdldENsaWVudFJlY3RzKClbMF1cblxuICAgICAgICAgICAgICAgICMgQWRkIGEgY2hpbGQgb24gdGhlIEFscGhhIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBhZGQ6IChlbGVtZW50KSAtPlxuICAgICAgICAgICAgICAgICAgICBAZWwuYXBwZW5kQ2hpbGQgZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICAgICAgQm9keS5lbGVtZW50LmFkZCBAZWxlbWVudC5lbCwgMVxuXG4gICAgICAgICMgIFVwZGF0ZSBlbGVtZW50IHJlY3QgcG9zaXRpb24gd2hlbiBDb2xvciBQaWNrZXIgb3BlbnNcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uT3BlbiA9PiBAZWxlbWVudC51cGRhdGVSZWN0KClcblxuICAgICAgICAjICBDcmVhdGUgYW5kIGRyYXcgY2FudmFzXG4gICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBzZXRUaW1lb3V0ID0+ICMgd2FpdCBmb3IgdGhlIERPTVxuICAgICAgICAgICAgICAgIEFscGhhID0gdGhpc1xuICAgICAgICAgICAgICAgIFNhdHVyYXRpb24gPSBjb2xvclBpY2tlci5nZXRFeHRlbnNpb24gJ1NhdHVyYXRpb24nXG5cbiAgICAgICAgICAgICAgICAjIFByZXBhcmUgc29tZSB2YXJpYWJsZXNcbiAgICAgICAgICAgICAgICBfZWxlbWVudFdpZHRoID0gQGVsZW1lbnQuZ2V0V2lkdGgoKVxuICAgICAgICAgICAgICAgIF9lbGVtZW50SGVpZ2h0ID0gQGVsZW1lbnQuZ2V0SGVpZ2h0KClcblxuICAgICAgICAgICAgICAgICMgQ3JlYXRlIGNhbnZhcyBlbGVtZW50XG4gICAgICAgICAgICAgICAgQGNhbnZhcyA9XG4gICAgICAgICAgICAgICAgICAgIGVsOiBkbyAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgX2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAnY2FudmFzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgX2VsLndpZHRoID0gX2VsZW1lbnRXaWR0aFxuICAgICAgICAgICAgICAgICAgICAgICAgX2VsLmhlaWdodCA9IF9lbGVtZW50SGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICBfZWwuY2xhc3NMaXN0LmFkZCBcIiN7IEFscGhhLmVsZW1lbnQuZWwuY2xhc3NOYW1lIH0tY2FudmFzXCJcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9lbFxuICAgICAgICAgICAgICAgICAgICAjIFV0aWxpdHkgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q29udGV4dDogLT4gQGNvbnRleHQgb3IgKEBjb250ZXh0ID0gQGVsLmdldENvbnRleHQgJzJkJylcblxuICAgICAgICAgICAgICAgICAgICAjIFJlbmRlciBBbHBoYSBjYW52YXNcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNSZW5kZXI6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyOiAoc21hcnRDb2xvcikgLT5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZ2IgPSAoIGRvIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5sZXNzIHNtYXJ0Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yUGlja2VyLlNtYXJ0Q29sb3IuSEVYICcjZjAwJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHNtYXJ0Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICkudG9SR0JBcnJheSgpLmpvaW4gJywnXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpZiBAcHJldmlvdXNSZW5kZXIgYW5kIEBwcmV2aW91c1JlbmRlciBpcyBfcmdiXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IGNvbnRleHQgYW5kIGNsZWFyIGl0XG4gICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dCA9IEBnZXRDb250ZXh0KClcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LmNsZWFyUmVjdCAwLCAwLCBfZWxlbWVudFdpZHRoLCBfZWxlbWVudEhlaWdodFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAjIERyYXcgYWxwaGEgY2hhbm5lbFxuICAgICAgICAgICAgICAgICAgICAgICAgX2dyYWRpZW50ID0gX2NvbnRleHQuY3JlYXRlTGluZWFyR3JhZGllbnQgMCwgMCwgMSwgX2VsZW1lbnRIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgIF9ncmFkaWVudC5hZGRDb2xvclN0b3AgLjAxLCBcInJnYmEoI3sgX3JnYiB9LDEpXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9ncmFkaWVudC5hZGRDb2xvclN0b3AgLjk5LCBcInJnYmEoI3sgX3JnYiB9LDApXCJcblxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQuZmlsbFN0eWxlID0gX2dyYWRpZW50XG4gICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5maWxsUmVjdCAwLCAwLCBfZWxlbWVudFdpZHRoLCBfZWxlbWVudEhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEBwcmV2aW91c1JlbmRlciA9IF9yZ2JcblxuICAgICAgICAgICAgICAgICMgUmVuZGVyIGFnYWluIG9uIFNhdHVyYXRpb24gY29sb3IgY2hhbmdlXG4gICAgICAgICAgICAgICAgU2F0dXJhdGlvbi5vbkNvbG9yQ2hhbmdlZCAoc21hcnRDb2xvcikgPT5cbiAgICAgICAgICAgICAgICAgICAgQGNhbnZhcy5yZW5kZXIgc21hcnRDb2xvclxuICAgICAgICAgICAgICAgIEBjYW52YXMucmVuZGVyKClcblxuICAgICAgICAgICAgICAgICMgQWRkIHRvIEFscGhhIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBAZWxlbWVudC5hZGQgQGNhbnZhcy5lbFxuXG4gICAgICAgICMgIENyZWF0ZSBBbHBoYSBjb250cm9sIGVsZW1lbnRcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHNldFRpbWVvdXQgPT4gIyB3YWl0IGZvciB0aGUgRE9NXG4gICAgICAgICAgICAgICAgaGFzQ2hpbGQgPSAoZWxlbWVudCwgY2hpbGQpIC0+XG4gICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkIGFuZCBfcGFyZW50ID0gY2hpbGQucGFyZW50Tm9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGQgaXMgZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBoYXNDaGlsZCBlbGVtZW50LCBfcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuXG4gICAgICAgICAgICAgICAgIyBDcmVhdGUgZWxlbWVudFxuICAgICAgICAgICAgICAgIEFscGhhID0gdGhpc1xuICAgICAgICAgICAgICAgIFNhdHVyYXRpb24gPSBjb2xvclBpY2tlci5nZXRFeHRlbnNpb24gJ1NhdHVyYXRpb24nXG5cbiAgICAgICAgICAgICAgICBAY29udHJvbCA9XG4gICAgICAgICAgICAgICAgICAgIGVsOiBkbyAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgX2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAnZGl2J1xuICAgICAgICAgICAgICAgICAgICAgICAgX2VsLmNsYXNzTGlzdC5hZGQgXCIjeyBBbHBoYS5lbGVtZW50LmVsLmNsYXNzTmFtZSB9LWNvbnRyb2xcIlxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2VsXG4gICAgICAgICAgICAgICAgICAgIGlzR3JhYmJpbmc6IG5vXG5cbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNDb250cm9sUG9zaXRpb246IG51bGxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29udHJvbFBvc2l0aW9uOiAoeSkgLT5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9qb2luZWQgPSBcIiwjeyB5IH1cIlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlmIEBwcmV2aW91c0NvbnRyb2xQb3NpdGlvbiBhbmQgQHByZXZpb3VzQ29udHJvbFBvc2l0aW9uIGlzIF9qb2luZWRcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQGVsLnN0eWxlLnRvcCA9IFwiI3sgeSB9cHhcIlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEBwcmV2aW91c0NvbnRyb2xQb3NpdGlvbiA9IF9qb2luZWRcblxuICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb246XG4gICAgICAgICAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgc2V0U2VsZWN0aW9uOiAoZSwgYWxwaGE9bnVsbCwgb2Zmc2V0PW51bGwpIC0+XG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVjdCA9IEFscGhhLmVsZW1lbnQuZ2V0UmVjdCgpXG4gICAgICAgICAgICAgICAgICAgICAgICBfd2lkdGggPSBBbHBoYS5lbGVtZW50LmdldFdpZHRoKClcbiAgICAgICAgICAgICAgICAgICAgICAgIF9oZWlnaHQgPSBBbHBoYS5lbGVtZW50LmdldEhlaWdodCgpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGUgdGhlbiBfeSA9IGUucGFnZVkgLSBfcmVjdC50b3BcbiAgICAgICAgICAgICAgICAgICAgICAgICMgU2V0IHRoZSBhbHBoYSBkaXJlY3RseVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGFscGhhIGlzICdudW1iZXInKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF95ID0gX2hlaWdodCAtIChhbHBoYSAqIF9oZWlnaHQpICMgcmV2ZXJzZWQsIDEgaXMgdG9wXG4gICAgICAgICAgICAgICAgICAgICAgICAjIEhhbmRsZSBzY3JvbGxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvZmZzZXQgaXMgJ251bWJlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3kgPSBAc2VsZWN0aW9uLnkgKyBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgICMgRGVmYXVsdCB0byBwcmV2aW91cyB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgX3kgPSBAc2VsZWN0aW9uLnlcblxuICAgICAgICAgICAgICAgICAgICAgICAgX3kgPSBAc2VsZWN0aW9uLnkgPSBNYXRoLm1heCAwLCAoTWF0aC5taW4gX2hlaWdodCwgX3kpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9hbHBoYSA9IDEgLSAoX3kgLyBfaGVpZ2h0KSAjIHJldmVyc2VkLCAxIGlzIHRvcFxuICAgICAgICAgICAgICAgICAgICAgICAgQHNlbGVjdGlvbi5hbHBoYSA9IChNYXRoLnJvdW5kIF9hbHBoYSAqIDEwMCkgLyAxMDAgIyAyIGRlY2ltYWwgcHJlY2lzaW9uXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICMgVXBkYXRlIHRoZSBzbWFydENvbG9yIChpZiBhbnkpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBfc21hcnRDb2xvciA9IEBzZWxlY3Rpb24uY29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfUkdCQUFycmF5ID0gX3NtYXJ0Q29sb3IudG9SR0JBQXJyYXkoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9SR0JBQXJyYXlbM10gPSBAc2VsZWN0aW9uLmFscGhhXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAc2VsZWN0aW9uLmNvbG9yID0gY29sb3JQaWNrZXIuU21hcnRDb2xvci5SR0JBQXJyYXkgX1JHQkFBcnJheVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFscGhhLmVtaXRDb2xvckNoYW5nZWQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgIyBPciBzZXQgYSBkZWZhdWx0IHJlZFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBAc2VsZWN0aW9uLmNvbG9yID0gY29sb3JQaWNrZXIuU21hcnRDb2xvci5SR0JBQXJyYXkgWzI1NSwgMCwgMCwgQHNlbGVjdGlvbi5hbHBoYV1cblxuICAgICAgICAgICAgICAgICAgICAgICAgX3Bvc2l0aW9uID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBNYXRoLm1heCAzLCAoTWF0aC5taW4gKF9oZWlnaHQgLSA2KSwgX3kpXG4gICAgICAgICAgICAgICAgICAgICAgICBAdXBkYXRlQ29udHJvbFBvc2l0aW9uIF9wb3NpdGlvbi55XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBBbHBoYS5lbWl0U2VsZWN0aW9uQ2hhbmdlZCgpXG5cbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFNlbGVjdGlvbjogLT4gQHNldFNlbGVjdGlvbigpXG4gICAgICAgICAgICAgICAgQGNvbnRyb2wucmVmcmVzaFNlbGVjdGlvbigpXG5cbiAgICAgICAgICAgICAgICAjIElmIHRoZSBDb2xvciBQaWNrZXIgaXMgZmVkIGEgY29sb3IsIHNldCBpdFxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uSW5wdXRDb2xvciAoc21hcnRDb2xvcikgPT5cbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuc2V0U2VsZWN0aW9uIG51bGwsIHNtYXJ0Q29sb3IuZ2V0QWxwaGEoKVxuXG4gICAgICAgICAgICAgICAgIyBSZXNldFxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uT3BlbiA9PiBAY29udHJvbC5pc0dyYWJiaW5nID0gbm9cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbkNsb3NlID0+IEBjb250cm9sLmlzR3JhYmJpbmcgPSBub1xuXG4gICAgICAgICAgICAgICAgIyBCaW5kIGNvbnRyb2xsZXIgZXZlbnRzXG4gICAgICAgICAgICAgICAgU2F0dXJhdGlvbi5vbkNvbG9yQ2hhbmdlZCAoc21hcnRDb2xvcikgPT5cbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuc2VsZWN0aW9uLmNvbG9yID0gc21hcnRDb2xvclxuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5yZWZyZXNoU2VsZWN0aW9uKClcblxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VEb3duIChlLCBpc09uUGlja2VyKSA9PlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIGlzT25QaWNrZXIgYW5kIGhhc0NoaWxkIEFscGhhLmVsZW1lbnQuZWwsIGUudGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5pc0dyYWJiaW5nID0geWVzXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBlXG5cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlTW92ZSAoZSkgPT5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBAY29udHJvbC5pc0dyYWJiaW5nXG4gICAgICAgICAgICAgICAgICAgIEBjb250cm9sLnNldFNlbGVjdGlvbiBlXG5cbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlVXAgKGUpID0+XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmxlc3MgQGNvbnRyb2wuaXNHcmFiYmluZ1xuICAgICAgICAgICAgICAgICAgICBAY29udHJvbC5pc0dyYWJiaW5nID0gbm9cbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuc2V0U2VsZWN0aW9uIGVcblxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VXaGVlbCAoZSwgaXNPblBpY2tlcikgPT5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBpc09uUGlja2VyIGFuZCBoYXNDaGlsZCBBbHBoYS5lbGVtZW50LmVsLCBlLnRhcmdldFxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICAgICAgQGNvbnRyb2wuc2V0U2VsZWN0aW9uIG51bGwsIG51bGwsIChlLndoZWVsRGVsdGFZICogLjMzKSAjIG1ha2UgaXQgYSBiaXQgc29mdGVyXG5cbiAgICAgICAgICAgICAgICAjIEFkZCB0byBBbHBoYSBlbGVtZW50XG4gICAgICAgICAgICAgICAgQGVsZW1lbnQuYWRkIEBjb250cm9sLmVsXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuIl19

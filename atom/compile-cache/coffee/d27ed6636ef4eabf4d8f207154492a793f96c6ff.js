(function() {
  module.exports = function(colorPicker) {
    return {
      element: null,
      pointer: null,
      activate: function() {
        var _isClicking, hasChild;
        this.element = {
          el: (function() {
            var _classPrefix, _el;
            _classPrefix = colorPicker.element.el.className;
            _el = document.createElement('div');
            _el.classList.add(_classPrefix + "-definition");
            return _el;
          })(),
          height: function() {
            return this.el.offsetHeight;
          },
          add: function(element) {
            this.el.appendChild(element);
            return this;
          },
          setColor: function(smartColor) {
            return this.el.style.backgroundColor = smartColor.toRGBA();
          }
        };
        colorPicker.element.add(this.element.el);
        setTimeout((function(_this) {
          return function() {
            var $colorPicker, Arrow;
            Arrow = colorPicker.getExtension('Arrow');
            $colorPicker = colorPicker.element;
            colorPicker.onInputVariable(function() {
              var _newHeight, _oldHeight, onClose;
              _oldHeight = $colorPicker.height();
              $colorPicker.addClass('view--definition');
              _newHeight = _this.element.height() + Arrow.element.height();
              $colorPicker.setHeight(_newHeight);
              _this.element.setColor(colorPicker.SmartColor.RGBAArray([0, 0, 0, 0]));
              onClose = function() {
                colorPicker.canOpen = true;
                $colorPicker.setHeight(_oldHeight);
                $colorPicker.removeClass('view--definition');
                return colorPicker.Emitter.off('close', onClose);
              };
              return colorPicker.onClose(onClose);
            });
            colorPicker.onInputColor(function() {
              return $colorPicker.removeClass('view--definition');
            });
          };
        })(this));
        colorPicker.onInputVariableColor((function(_this) {
          return function(smartColor) {
            if (!smartColor) {
              return;
            }
            return _this.element.setColor(smartColor);
          };
        })(this));
        colorPicker.onInputVariableColor((function(_this) {
          return function() {
            var pointer;
            pointer = arguments[arguments.length - 1];
            return _this.pointer = pointer;
          };
        })(this));
        hasChild = function(element, child) {
          var _parent;
          if (child && (_parent = child.parentNode)) {
            if (child === element) {
              return true;
            } else {
              return hasChild(element, _parent);
            }
          }
          return false;
        };
        _isClicking = false;
        colorPicker.onMouseDown((function(_this) {
          return function(e, isOnPicker) {
            if (!(isOnPicker && hasChild(_this.element.el, e.target))) {
              return;
            }
            e.preventDefault();
            return _isClicking = true;
          };
        })(this));
        colorPicker.onMouseMove(function(e) {
          return _isClicking = false;
        });
        colorPicker.onMouseUp((function(_this) {
          return function(e) {
            if (!(_isClicking && _this.pointer)) {
              return;
            }
            atom.workspace.open(_this.pointer.filePath).then(function() {
              var Editor;
              Editor = atom.workspace.getActiveTextEditor();
              Editor.clearSelections();
              Editor.setSelectedBufferRange(_this.pointer.range);
              Editor.scrollToCursorPosition();
              return colorPicker.close();
            });
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var _definition;
            _definition = document.createElement('p');
            _definition.classList.add(_this.element.el.className + "-definition");
            colorPicker.onInputVariable(function() {
              return _definition.innerText = '';
            });
            colorPicker.onInputVariableColor(function(color) {
              if (color) {
                return _definition.innerText = color.value;
              } else {
                return _definition.innerText = 'No color found.';
              }
            });
            return _this.element.add(_definition);
          };
        })(this));
        setTimeout((function(_this) {
          return function() {
            var _variable;
            _variable = document.createElement('p');
            _variable.classList.add(_this.element.el.className + "-variable");
            colorPicker.onInputVariable(function(match) {
              return _variable.innerText = match.match;
            });
            return _this.element.add(_variable);
          };
        })(this));
        return this;
      }
    };
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvanVhbmpvLy5hdG9tL3BhY2thZ2VzL2NvbG9yLXBpY2tlci9saWIvZXh0ZW5zaW9ucy9EZWZpbml0aW9uLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFLSTtFQUFBLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLFNBQUMsV0FBRDtXQUNiO01BQUEsT0FBQSxFQUFTLElBQVQ7TUFDQSxPQUFBLEVBQVMsSUFEVDtNQU1BLFFBQUEsRUFBVSxTQUFBO0FBQ04sWUFBQTtRQUFBLElBQUMsQ0FBQSxPQUFELEdBQ0k7VUFBQSxFQUFBLEVBQU8sQ0FBQSxTQUFBO0FBQ0gsZ0JBQUE7WUFBQSxZQUFBLEdBQWUsV0FBVyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDdEMsR0FBQSxHQUFNLFFBQVEsQ0FBQyxhQUFULENBQXVCLEtBQXZCO1lBQ04sR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFkLENBQXNCLFlBQUYsR0FBZ0IsYUFBcEM7QUFFQSxtQkFBTztVQUxKLENBQUEsQ0FBSCxDQUFBLENBQUo7VUFPQSxNQUFBLEVBQVEsU0FBQTttQkFBRyxJQUFDLENBQUEsRUFBRSxDQUFDO1VBQVAsQ0FQUjtVQVVBLEdBQUEsRUFBSyxTQUFDLE9BQUQ7WUFDRCxJQUFDLENBQUEsRUFBRSxDQUFDLFdBQUosQ0FBZ0IsT0FBaEI7QUFDQSxtQkFBTztVQUZOLENBVkw7VUFlQSxRQUFBLEVBQVUsU0FBQyxVQUFEO21CQUNOLElBQUMsQ0FBQSxFQUFFLENBQUMsS0FBSyxDQUFDLGVBQVYsR0FBNEIsVUFBVSxDQUFDLE1BQVgsQ0FBQTtVQUR0QixDQWZWOztRQWlCSixXQUFXLENBQUMsT0FBTyxDQUFDLEdBQXBCLENBQXdCLElBQUMsQ0FBQSxPQUFPLENBQUMsRUFBakM7UUFJQSxVQUFBLENBQVcsQ0FBQSxTQUFBLEtBQUE7aUJBQUEsU0FBQTtBQUNQLGdCQUFBO1lBQUEsS0FBQSxHQUFRLFdBQVcsQ0FBQyxZQUFaLENBQXlCLE9BQXpCO1lBQ1IsWUFBQSxHQUFlLFdBQVcsQ0FBQztZQUczQixXQUFXLENBQUMsZUFBWixDQUE0QixTQUFBO0FBQ3hCLGtCQUFBO2NBQUEsVUFBQSxHQUFhLFlBQVksQ0FBQyxNQUFiLENBQUE7Y0FDYixZQUFZLENBQUMsUUFBYixDQUFzQixrQkFBdEI7Y0FFQSxVQUFBLEdBQWEsS0FBQyxDQUFBLE9BQU8sQ0FBQyxNQUFULENBQUEsQ0FBQSxHQUFvQixLQUFLLENBQUMsT0FBTyxDQUFDLE1BQWQsQ0FBQTtjQUNqQyxZQUFZLENBQUMsU0FBYixDQUF1QixVQUF2QjtjQUdBLEtBQUMsQ0FBQSxPQUFPLENBQUMsUUFBVCxDQUFrQixXQUFXLENBQUMsVUFBVSxDQUFDLFNBQXZCLENBQWlDLENBQUMsQ0FBRCxFQUFJLENBQUosRUFBTyxDQUFQLEVBQVUsQ0FBVixDQUFqQyxDQUFsQjtjQUlBLE9BQUEsR0FBVSxTQUFBO2dCQUNOLFdBQVcsQ0FBQyxPQUFaLEdBQXNCO2dCQUN0QixZQUFZLENBQUMsU0FBYixDQUF1QixVQUF2QjtnQkFDQSxZQUFZLENBQUMsV0FBYixDQUF5QixrQkFBekI7dUJBR0EsV0FBVyxDQUFDLE9BQU8sQ0FBQyxHQUFwQixDQUF3QixPQUF4QixFQUFpQyxPQUFqQztjQU5NO3FCQU9WLFdBQVcsQ0FBQyxPQUFaLENBQW9CLE9BQXBCO1lBbkJ3QixDQUE1QjtZQXNCQSxXQUFXLENBQUMsWUFBWixDQUF5QixTQUFBO3FCQUNyQixZQUFZLENBQUMsV0FBYixDQUF5QixrQkFBekI7WUFEcUIsQ0FBekI7VUEzQk87UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQVg7UUFpQ0EsV0FBVyxDQUFDLG9CQUFaLENBQWlDLENBQUEsU0FBQSxLQUFBO2lCQUFBLFNBQUMsVUFBRDtZQUM3QixJQUFBLENBQWMsVUFBZDtBQUFBLHFCQUFBOzttQkFDQSxLQUFDLENBQUEsT0FBTyxDQUFDLFFBQVQsQ0FBa0IsVUFBbEI7VUFGNkI7UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQWpDO1FBTUEsV0FBVyxDQUFDLG9CQUFaLENBQWlDLENBQUEsU0FBQSxLQUFBO2lCQUFBLFNBQUE7QUFHN0IsZ0JBQUE7WUFIbUM7bUJBR25DLEtBQUMsQ0FBQSxPQUFELEdBQVc7VUFIa0I7UUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQWpDO1FBS0EsUUFBQSxHQUFXLFNBQUMsT0FBRCxFQUFVLEtBQVY7QUFDUCxjQUFBO1VBQUEsSUFBRyxLQUFBLElBQVUsQ0FBQSxPQUFBLEdBQVUsS0FBSyxDQUFDLFVBQWhCLENBQWI7WUFDSSxJQUFHLEtBQUEsS0FBUyxPQUFaO0FBQ0kscUJBQU8sS0FEWDthQUFBLE1BQUE7QUFFSyxxQkFBTyxRQUFBLENBQVMsT0FBVCxFQUFrQixPQUFsQixFQUZaO2FBREo7O0FBSUEsaUJBQU87UUFMQTtRQU9YLFdBQUEsR0FBYztRQUVkLFdBQVcsQ0FBQyxXQUFaLENBQXdCLENBQUEsU0FBQSxLQUFBO2lCQUFBLFNBQUMsQ0FBRCxFQUFJLFVBQUo7WUFDcEIsSUFBQSxDQUFBLENBQWMsVUFBQSxJQUFlLFFBQUEsQ0FBUyxLQUFDLENBQUEsT0FBTyxDQUFDLEVBQWxCLEVBQXNCLENBQUMsQ0FBQyxNQUF4QixDQUE3QixDQUFBO0FBQUEscUJBQUE7O1lBQ0EsQ0FBQyxDQUFDLGNBQUYsQ0FBQTttQkFDQSxXQUFBLEdBQWM7VUFITTtRQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBeEI7UUFLQSxXQUFXLENBQUMsV0FBWixDQUF3QixTQUFDLENBQUQ7aUJBQ3BCLFdBQUEsR0FBYztRQURNLENBQXhCO1FBR0EsV0FBVyxDQUFDLFNBQVosQ0FBc0IsQ0FBQSxTQUFBLEtBQUE7aUJBQUEsU0FBQyxDQUFEO1lBQ2xCLElBQUEsQ0FBQSxDQUFjLFdBQUEsSUFBZ0IsS0FBQyxDQUFBLE9BQS9CLENBQUE7QUFBQSxxQkFBQTs7WUFFQSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQWYsQ0FBb0IsS0FBQyxDQUFBLE9BQU8sQ0FBQyxRQUE3QixDQUFzQyxDQUFDLElBQXZDLENBQTRDLFNBQUE7QUFDeEMsa0JBQUE7Y0FBQSxNQUFBLEdBQVMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBZixDQUFBO2NBQ1QsTUFBTSxDQUFDLGVBQVAsQ0FBQTtjQUNBLE1BQU0sQ0FBQyxzQkFBUCxDQUE4QixLQUFDLENBQUEsT0FBTyxDQUFDLEtBQXZDO2NBQ0EsTUFBTSxDQUFDLHNCQUFQLENBQUE7cUJBRUEsV0FBVyxDQUFDLEtBQVosQ0FBQTtZQU53QyxDQUE1QztVQUhrQjtRQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBdEI7UUFjQSxVQUFBLENBQVcsQ0FBQSxTQUFBLEtBQUE7aUJBQUEsU0FBQTtBQUVQLGdCQUFBO1lBQUEsV0FBQSxHQUFjLFFBQVEsQ0FBQyxhQUFULENBQXVCLEdBQXZCO1lBQ2QsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUF0QixDQUE4QixLQUFDLENBQUEsT0FBTyxDQUFDLEVBQUUsQ0FBQyxTQUFkLEdBQXlCLGFBQXJEO1lBR0EsV0FBVyxDQUFDLGVBQVosQ0FBNEIsU0FBQTtxQkFDeEIsV0FBVyxDQUFDLFNBQVosR0FBd0I7WUFEQSxDQUE1QjtZQUlBLFdBQVcsQ0FBQyxvQkFBWixDQUFpQyxTQUFDLEtBQUQ7Y0FFN0IsSUFBRyxLQUFIO3VCQUFjLFdBQVcsQ0FBQyxTQUFaLEdBQXdCLEtBQUssQ0FBQyxNQUE1QztlQUFBLE1BQUE7dUJBRUssV0FBVyxDQUFDLFNBQVosR0FBd0Isa0JBRjdCOztZQUY2QixDQUFqQzttQkFPQSxLQUFDLENBQUEsT0FBTyxDQUFDLEdBQVQsQ0FBYSxXQUFiO1VBakJPO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFYO1FBcUJBLFVBQUEsQ0FBVyxDQUFBLFNBQUEsS0FBQTtpQkFBQSxTQUFBO0FBRVAsZ0JBQUE7WUFBQSxTQUFBLEdBQVksUUFBUSxDQUFDLGFBQVQsQ0FBdUIsR0FBdkI7WUFDWixTQUFTLENBQUMsU0FBUyxDQUFDLEdBQXBCLENBQTRCLEtBQUMsQ0FBQSxPQUFPLENBQUMsRUFBRSxDQUFDLFNBQWQsR0FBeUIsV0FBbkQ7WUFHQSxXQUFXLENBQUMsZUFBWixDQUE0QixTQUFDLEtBQUQ7cUJBQ3hCLFNBQVMsQ0FBQyxTQUFWLEdBQXNCLEtBQUssQ0FBQztZQURKLENBQTVCO21CQUlBLEtBQUMsQ0FBQSxPQUFPLENBQUMsR0FBVCxDQUFhLFNBQWI7VUFWTztRQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBWDtBQVdBLGVBQU87TUFsSUQsQ0FOVjs7RUFEYTtBQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyAgQ29sb3IgUGlja2VyL2V4dGVuc2lvbnM6IERlZmluaXRpb25cbiMgIFRoZSBlbGVtZW50IHNob3dpbmcgdGhlIGN1cnJlbnQgdmFyaWFibGUgZGVmaW5pdGlvblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IChjb2xvclBpY2tlcikgLT5cbiAgICAgICAgZWxlbWVudDogbnVsbFxuICAgICAgICBwb2ludGVyOiBudWxsXG5cbiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAjICBDcmVhdGUgYW5kIGFjdGl2YXRlIERlZmluaXRpb24gZWxlbWVudFxuICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICBhY3RpdmF0ZTogLT5cbiAgICAgICAgICAgIEBlbGVtZW50ID1cbiAgICAgICAgICAgICAgICBlbDogZG8gLT5cbiAgICAgICAgICAgICAgICAgICAgX2NsYXNzUHJlZml4ID0gY29sb3JQaWNrZXIuZWxlbWVudC5lbC5jbGFzc05hbWVcbiAgICAgICAgICAgICAgICAgICAgX2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAnZGl2J1xuICAgICAgICAgICAgICAgICAgICBfZWwuY2xhc3NMaXN0LmFkZCBcIiN7IF9jbGFzc1ByZWZpeCB9LWRlZmluaXRpb25cIlxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfZWxcbiAgICAgICAgICAgICAgICAjIFV0aWxpdHkgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAtPiBAZWwub2Zmc2V0SGVpZ2h0XG5cbiAgICAgICAgICAgICAgICAjIEFkZCBhIGNoaWxkIG9uIHRoZSBEZWZpbml0aW9uIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBhZGQ6IChlbGVtZW50KSAtPlxuICAgICAgICAgICAgICAgICAgICBAZWwuYXBwZW5kQ2hpbGQgZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1xuXG4gICAgICAgICAgICAgICAgIyBTZXQgdGhlIERlZmluaXRpb24gZWxlbWVudCBiYWNrZ3JvdW5kIGNvbG9yXG4gICAgICAgICAgICAgICAgc2V0Q29sb3I6IChzbWFydENvbG9yKSAtPlxuICAgICAgICAgICAgICAgICAgICBAZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gc21hcnRDb2xvci50b1JHQkEoKVxuICAgICAgICAgICAgY29sb3JQaWNrZXIuZWxlbWVudC5hZGQgQGVsZW1lbnQuZWxcblxuICAgICAgICAjICBTZXQgQ29sb3IgUGlja2VyIGhlaWdodFxuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgc2V0VGltZW91dCA9PlxuICAgICAgICAgICAgICAgIEFycm93ID0gY29sb3JQaWNrZXIuZ2V0RXh0ZW5zaW9uICdBcnJvdydcbiAgICAgICAgICAgICAgICAkY29sb3JQaWNrZXIgPSBjb2xvclBpY2tlci5lbGVtZW50XG5cbiAgICAgICAgICAgICAgICAjIENoYW5nZSB2aWV3IG1vZGUgd2hlbiBhIHZhcmlhYmxlIGlzIGlucHV0XG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25JbnB1dFZhcmlhYmxlID0+XG4gICAgICAgICAgICAgICAgICAgIF9vbGRIZWlnaHQgPSAkY29sb3JQaWNrZXIuaGVpZ2h0KClcbiAgICAgICAgICAgICAgICAgICAgJGNvbG9yUGlja2VyLmFkZENsYXNzICd2aWV3LS1kZWZpbml0aW9uJ1xuXG4gICAgICAgICAgICAgICAgICAgIF9uZXdIZWlnaHQgPSBAZWxlbWVudC5oZWlnaHQoKSArIEFycm93LmVsZW1lbnQuaGVpZ2h0KClcbiAgICAgICAgICAgICAgICAgICAgJGNvbG9yUGlja2VyLnNldEhlaWdodCBfbmV3SGVpZ2h0XG5cbiAgICAgICAgICAgICAgICAgICAgIyBSZXNldCBjdXJyZW50IGVsZW1lbnQgYmFja2dyb3VuZCBjb2xvclxuICAgICAgICAgICAgICAgICAgICBAZWxlbWVudC5zZXRDb2xvciBjb2xvclBpY2tlci5TbWFydENvbG9yLlJHQkFBcnJheSBbMCwgMCwgMCwgMF1cblxuICAgICAgICAgICAgICAgICAgICAjIFJlc2V0IHBpY2tlciBvbiBjbG9zZSwgYW5kIGNsZWFyIHRoZSBldmVudFxuICAgICAgICAgICAgICAgICAgICAjIFRPRE8gaGFuZGxlIHRoaXMgb24gdGhlIENvbG9yUGlja2VyIGl0c2VsZiwgbWF5YmU/XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2UgPSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JQaWNrZXIuY2FuT3BlbiA9IHllc1xuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbG9yUGlja2VyLnNldEhlaWdodCBfb2xkSGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICAkY29sb3JQaWNrZXIucmVtb3ZlQ2xhc3MgJ3ZpZXctLWRlZmluaXRpb24nXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICMgVE9ETzogVGhpcyBraW5kYSBnb2VzIGFnYWluc3QgdGhlICdubyBzdHJpbmdzJyB0aGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JQaWNrZXIuRW1pdHRlci5vZmYgJ2Nsb3NlJywgb25DbG9zZVxuICAgICAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbkNsb3NlIG9uQ2xvc2VcblxuICAgICAgICAgICAgICAgICMgTWFrZSBzdXJlIHRoZSBjbGFzcyBpcyBuZXZlciBzZXQgd2hlbiBhIGNvbG9yIGlzIGlucHV0XG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25JbnB1dENvbG9yIC0+XG4gICAgICAgICAgICAgICAgICAgICRjb2xvclBpY2tlci5yZW1vdmVDbGFzcyAndmlldy0tZGVmaW5pdGlvbidcbiAgICAgICAgICAgICAgICByZXR1cm5cblxuICAgICAgICAjICBTZXQgYmFja2dyb3VuZCBlbGVtZW50IGNvbG9yIG9uIGNoYW5nZVxuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgY29sb3JQaWNrZXIub25JbnB1dFZhcmlhYmxlQ29sb3IgKHNtYXJ0Q29sb3IpID0+XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBzbWFydENvbG9yXG4gICAgICAgICAgICAgICAgQGVsZW1lbnQuc2V0Q29sb3Igc21hcnRDb2xvclxuXG4gICAgICAgICMgIFNldCBvciByZXBsYWNlIHNlbGVjdGlvbiBvbiBjbGlja1xuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgY29sb3JQaWNrZXIub25JbnB1dFZhcmlhYmxlQ29sb3IgKC4uLiwgcG9pbnRlcikgPT5cbiAgICAgICAgICAgICAgICAjIEtlZXAgdHJhY2sgb2YgdGhlIGN1cnJlbnQgcG9pbnRlciBmb3Igd2hlbiB0aGUgY29sb3IgaXNcbiAgICAgICAgICAgICAgICAjIHN1cHBvc2VkIHRvIGJlIHJlcGxhY2VkXG4gICAgICAgICAgICAgICAgQHBvaW50ZXIgPSBwb2ludGVyXG5cbiAgICAgICAgICAgIGhhc0NoaWxkID0gKGVsZW1lbnQsIGNoaWxkKSAtPlxuICAgICAgICAgICAgICAgIGlmIGNoaWxkIGFuZCBfcGFyZW50ID0gY2hpbGQucGFyZW50Tm9kZVxuICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZCBpcyBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBoYXNDaGlsZCBlbGVtZW50LCBfcGFyZW50XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgICAgIF9pc0NsaWNraW5nID0gbm9cblxuICAgICAgICAgICAgY29sb3JQaWNrZXIub25Nb3VzZURvd24gKGUsIGlzT25QaWNrZXIpID0+XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBpc09uUGlja2VyIGFuZCBoYXNDaGlsZCBAZWxlbWVudC5lbCwgZS50YXJnZXRcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICBfaXNDbGlja2luZyA9IHllc1xuXG4gICAgICAgICAgICBjb2xvclBpY2tlci5vbk1vdXNlTW92ZSAoZSkgLT5cbiAgICAgICAgICAgICAgICBfaXNDbGlja2luZyA9IG5vXG5cbiAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uTW91c2VVcCAoZSkgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5sZXNzIF9pc0NsaWNraW5nIGFuZCBAcG9pbnRlclxuXG4gICAgICAgICAgICAgICAgYXRvbS53b3Jrc3BhY2Uub3BlbihAcG9pbnRlci5maWxlUGF0aCkudGhlbiA9PlxuICAgICAgICAgICAgICAgICAgICBFZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKClcbiAgICAgICAgICAgICAgICAgICAgRWRpdG9yLmNsZWFyU2VsZWN0aW9ucygpXG4gICAgICAgICAgICAgICAgICAgIEVkaXRvci5zZXRTZWxlY3RlZEJ1ZmZlclJhbmdlIEBwb2ludGVyLnJhbmdlXG4gICAgICAgICAgICAgICAgICAgIEVkaXRvci5zY3JvbGxUb0N1cnNvclBvc2l0aW9uKClcblxuICAgICAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5jbG9zZSgpXG4gICAgICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgIyAgQ3JlYXRlIERlZmluaXRpb24gZGVmaW5pdGlvbiB0ZXh0IGVsZW1lbnRcbiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHNldFRpbWVvdXQgPT5cbiAgICAgICAgICAgICAgICAjIENyZWF0ZSBkZWZpbml0aW9uIHRleHQgZWxlbWVudFxuICAgICAgICAgICAgICAgIF9kZWZpbml0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAncCdcbiAgICAgICAgICAgICAgICBfZGVmaW5pdGlvbi5jbGFzc0xpc3QuYWRkIFwiI3sgQGVsZW1lbnQuZWwuY2xhc3NOYW1lIH0tZGVmaW5pdGlvblwiXG5cbiAgICAgICAgICAgICAgICAjIFJlbW92ZSB0aGUgZGVmaW5pdGlvbiB3aGVuIGEgbmV3IHZhcmlhYmxlIGlzIGlucHV0XG4gICAgICAgICAgICAgICAgY29sb3JQaWNrZXIub25JbnB1dFZhcmlhYmxlIC0+XG4gICAgICAgICAgICAgICAgICAgIF9kZWZpbml0aW9uLmlubmVyVGV4dCA9ICcnXG5cbiAgICAgICAgICAgICAgICAjIFNldCBkZWZpbml0aW9uIHdoZW4gdGhlIGRlZmluaXRpb24gaXMgZm91bmRcbiAgICAgICAgICAgICAgICBjb2xvclBpY2tlci5vbklucHV0VmFyaWFibGVDb2xvciAoY29sb3IpIC0+XG4gICAgICAgICAgICAgICAgICAgICMgSWYgYSBjb2xvciBkZWZpbml0aW9uIGlzIGZvdW5kXG4gICAgICAgICAgICAgICAgICAgIGlmIGNvbG9yIHRoZW4gX2RlZmluaXRpb24uaW5uZXJUZXh0ID0gY29sb3IudmFsdWVcbiAgICAgICAgICAgICAgICAgICAgIyBJZiBubyBkZWZpbml0aW9uIGlzIGZvdW5kLCBzaG93IGFuIGVycm9yXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgX2RlZmluaXRpb24uaW5uZXJUZXh0ID0gJ05vIGNvbG9yIGZvdW5kLidcblxuICAgICAgICAgICAgICAgICMgQWRkIHRvIERlZmluaXRpb24gZWxlbWVudFxuICAgICAgICAgICAgICAgIEBlbGVtZW50LmFkZCBfZGVmaW5pdGlvblxuXG4gICAgICAgICMgIENyZWF0ZSBEZWZpbml0aW9uIHZhcmlhYmxlIHRleHQgZWxlbWVudFxuICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgc2V0VGltZW91dCA9PlxuICAgICAgICAgICAgICAgICMgQ3JlYXRlIHZhcmlhYmxlIHRleHQgZWxlbWVudFxuICAgICAgICAgICAgICAgIF92YXJpYWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJ3AnXG4gICAgICAgICAgICAgICAgX3ZhcmlhYmxlLmNsYXNzTGlzdC5hZGQgXCIjeyBAZWxlbWVudC5lbC5jbGFzc05hbWUgfS12YXJpYWJsZVwiXG5cbiAgICAgICAgICAgICAgICAjIFNldCB2YXJpYWJsZSB3aGVuIHRoZSB2YXJpYWJsZSBpcyBpbnB1dFxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyLm9uSW5wdXRWYXJpYWJsZSAobWF0Y2gpIC0+XG4gICAgICAgICAgICAgICAgICAgIF92YXJpYWJsZS5pbm5lclRleHQgPSBtYXRjaC5tYXRjaFxuXG4gICAgICAgICAgICAgICAgIyBBZGQgdG8gRGVmaW5pdGlvbiBlbGVtZW50XG4gICAgICAgICAgICAgICAgQGVsZW1lbnQuYWRkIF92YXJpYWJsZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiJdfQ==
